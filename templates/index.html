<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width= , initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <title>Ana sayfa</title>
    <style>
      .borderAnswer {
        border: 2px #2463ad solid;
        border-radius: 5px;
        padding: 10px;
        position: relative;
        /* Pozisyonu belirlemek için */
        margin-bottom: 15px;
      }

      .borderAnswer::before {
        content: "🤖";
        position: absolute;
        top: -20px;
        left: 5px;
        font-size: 24px;
      }

      .user-message {
        background-color: #f0f0f0;
        padding: 5px;
        margin-bottom: 15px;
      }
    </style>
  </head>

  <body>
    <header>
      <nav class="navbar bg-dark">
        <div class="container">
          <a class="navbar-brand text-white" href="#"> OKRCONNECTOR </a>
        </div>
      </nav>
    </header>

    <main class="flex-shrink-0">
      <div class="container">
        <br />
        <br />
        <h1 class="mt-5">OKRCONNECTOR</h1>
        <p class="lead">
          OKRCONNECTOR, yapay zeka ile OKR'larınızı yönetmenize yardımcı olur.
        </p>

        <div id="list-group" class="list-group w-auto"></div>

        <div class="row">
          <div class="col-md-6">
            <div class="input-group mb-3" id="formfield">
              <input
                type="text"
                class="form-control p-4"
                id="chat-name"
                placeholder="İsminizi yazınız"
              />
            </div>
          </div>
          <div class="col-md-6">
            <div class="input-group mb-3" id="formfield">
              <input
                type="text"
                class="form-control p-4"
                id="chat-input"
                placeholder="Şuanki pozisyonunuzu yazınız."
                maxlength="100"
              />
            </div>
          </div>
        </div>

        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-name"
            placeholder="İsminizi yazınız"
          />
        </div>
        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-input"
            placeholder="Şuanki pozisyonunuzu yazınız."
            maxlength="100"
          />
        </div>
        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-input2"
            placeholder="Kendinizi hangi alanda geliştirmek istiyorsunuz? "
            maxlength="100"
          />
        </div>
        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-input3"
            placeholder="Alaninizda öğrenmek istediğiniz teknolojiler neler?"
            maxlength="100"
          />
        </div>
        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-input4"
            placeholder="Alaninizda kendinizi iyi gördüğünüz teknolojiler neler?"
            maxlength="100"
          />
        </div>
        <div class="input-group mb-3" id="formfield">
          <input
            type="text"
            class="form-control p-4"
            id="chat-input5"
            placeholder="Alaninizda hiç bilmediğiniz teknolojiler neler?"
            maxlength="100"
          />
        </div>
        <div class="input-group-append">
          <button
            id="gpt-button"
            class="btn btn-secondary"
            onclick="sendChat()"
          >
            <span id="button-content">ASK</span>
          </button>
          <button
            id="reset-button"
            class="btn btn-primary ml-3"
            onclick="resetChat()"
          >
            Reset
          </button>
        </div>
        <div id="response" class="mt-3"></div>
        <div id="conversation" class="mt-3"></div>
      </div>
    </main>

    <script>
      var conversationHistory = []; // Bu dizi, konuşma geçmişini tutmak için kullanılacak

      function sendChat() {
        var input1 = document.getElementById("chat-input").value;
        var input2 = document.getElementById("chat-input2").value;
        var input3 = document.getElementById("chat-input3").value;
        var input4 = document.getElementById("chat-input4").value;
        var input5 = document.getElementById("chat-input5").value;
        var userName = document.getElementById("chat-name").value;

        if (!input1 || !input2 || !input3 || !input4 || !input5 || !userName) {
          alert("Lütfen tüm alanları doldurunuz");
          return;
        }

        // Input değerlerini birleştir
        var combinedInput = [input1, input2, input3, input4, input5].join(", ");

        if (combinedInput) {
          conversationHistory.push({ role: "user", content: combinedInput });
        }

        fetch("/generate_okr", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ input: combinedInput, userName: userName }),
        })
          .then((response) => response.json())
          .then((data) => {
            conversationHistory.push({
              role: "assistant",
              content: data.response,
            });

            var conversationDiv = document.getElementById("conversation");
            conversationDiv.innerHTML = ""; // Önceki konuşmayı temizle

            conversationHistory.forEach((message) => {
              var messageDiv = document.createElement("div");
              messageDiv.className =
                message.role === "user" ? "user-message" : "borderAnswer";
              messageDiv.textContent = message.content;
              conversationDiv.appendChild(messageDiv);
            });
          });
      }

      function resetChat() {
        conversationHistory = []; // Konuşma geçmişini sıfırla

        // Kullanıcı girdisini ve cevapları sıfırla
        document.getElementById("chat-input").value = "";
        document.getElementById("chat-input2").value = "";
        document.getElementById("chat-input3").value = "";
        document.getElementById("chat-input4").value = "";
        document.getElementById("chat-input5").value = "";
        document.getElementById("chat-name").value = "";
        document.getElementById("response").innerHTML = "";
        document.getElementById("conversation").innerHTML = "";
      }
    </script>

    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
